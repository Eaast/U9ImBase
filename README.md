# U9ImBase

智能工厂移动应用-Base库

- [初始化](#初始化)
- [共享数据](#共享数据)
    - [连接设置](#连接设置)
    - [服务器额外配置](#服务器额外配置)
    - [用户信息](#用户信息)
    - [设备注册信息](#设备注册信息)
    - [外接串口设备](#外接串口设备)
    - [Token](#Token)
- [数据存储路径](#数据存储路径)
- [轻应用间跳转](#轻应用间跳转)
    - [打开](#打开)
    - [关闭](#关闭)

## 初始化

#### 方法说明

```javascript
u9.init(cfg);
```

初始化方法，`务必于summerready前调用`。

#### 参数说明

`cfg`有以下配置项：

| 参数名      | 必填      | 类型      | 描述                         |
| ----------- | --------- | --------- | ---------------------------- |
| mainAppId   | 是        | string    | 壳应用ID，取值为U9ImHD(工业平板)、U9ImPDA(手持PDA)、U9ImTV(TV)     |
| appId       | 是        | string    | 轻应用ID                     |
| pageParam   | 否        | object    | 仅供浏览器调试时使用，设备启动时该配置无效   |

#### 调用示例

```javascript
var cfg = {
    mainAppId: 'U9ImPDA',
    appId: 'DemoPDA',
};
u9.init(cfg);
```

#### 返回值

无

## 共享数据

共享数据可使用`summer.pageParam`获取，这里提供一组方法以方便的获取智能工厂的共享数据。

### 连接设置

壳应用连接设置界面配置的ip地址和端口，即智能工厂的ip地址和端口。

#### 方法说明

```javascript
u9.Connect(key);
```

#### 参数说明

| 参数名    | 必填      | 类型      | 描述                         |
| --------- | --------- | --------- | ---------------------------- |
| key       | 否        | string    | 属性名，取值为address、port，为空时返回所有数据   |

#### 调用示例

```javascript
u9.Connect('address');
u9.Connect('port');
```

#### 返回值

对应的值, 如果不存在则返回null

---

### 服务器额外配置

对应智能工厂参数设置的信息，目前支持获取本地EMM地址和Socket通信端口。

#### 方法说明

```javascript
u9.ServeParam(key);
```

#### 参数说明

| 参数名    | 必填      | 类型      | 描述                         |
| --------- | --------- | --------- | ---------------------------- |
| key       | 否        | string    | 属性名，取值为GatewayAddress、SocketPort，为空时返回所有数据   |

#### 调用示例

```javascript
u9.ServeParam('GatewayAddress');
```

#### 返回值

对应的值，如果不存在则返回null

---

### 用户信息

登录用户信息。

#### 方法说明

```javascript
u9.User(key);
```

#### 参数说明

| 参数名    | 必填      | 类型      | 描述                         |
| --------- | --------- | --------- | ---------------------------- |
| key       | 否        | string    | 属性名，为空时返回所有数据   |

#### 调用示例

```javascript
u9.User('Code');
```

#### 返回值

对应的值, 如果不存在则返回null

---

### 设备注册信息

设备在系统注册后，可获取到设备信息；设备与工位绑定后，可获取到绑定工位信息和对应部门信息；绑定工位绑定作业后，则可获取到对应作业信息。

#### 方法说明

```javascript
u9.Device(key);
```

#### 参数说明

| 参数名    | 必填      | 类型      | 描述                         |
| --------- | --------- | --------- | ---------------------------- |
| key       | 否        | string    | 属性名，取值为Terminal(设备)、WorkLocation(工位)、Department(部门)、Work(作业)，为空时返回所有数据   |

#### 调用示例

```javascript
u9.Device('Terminal');
```

#### 返回值

对应的值, 如果不存在则返回null

---

### 外接串口设备

工业平板外接的串口设备，需在`设置`界面进行配置对应串口，仅工业平板应用有效。

#### 方法说明

```javascript
u9.ExtDevices();
```

#### 参数说明

无

#### 调用示例

```javascript
u9.ExtDevices();
```

#### 返回值

所有串口设备列表

---

### Token

用户登录认证成功后，服务器返回的Token。

#### 方法说明

```javascript
u9.Token();
```

#### 参数说明

无

#### 调用示例

```javascript
u9.Token();
```

#### 返回值

Token

## 数据存储路径

获取壳应用数据存储路径，方法如下：

| 方法名             | 传入参数  | 描述                         |
| ------------------ | --------- | ---------------------------- |
| getRootDir()       | 无        | 获取主应用根目录             |
| getDataDir()       | 无        | 获取主应用数据缓存目录       |
| getAppsDir()       | 无        | 获取轻应用存放目录           |

`getAbsolutePath()`说明如下：

#### 方法说明

```javascript
u9.getAbsolutePath(src, appId);
```

将轻应用下的路径转换成绝对路径，一般轻应用间跳转时会使用，获取目标轻应用`index.html`的绝对路径。

#### 参数说明

| 参数名    | 必填      | 类型      | 描述                         |
| --------- | --------- | --------- | ---------------------------- |
| src       | 是        | string    | 待转换路径，相对于轻应用     |
| appId     | 否        | string    | 待转换路径相对的轻应用，为空时取当前轻应用   |

#### 调用示例

```javascript
u9.getAbsolutePath('www/index.html', 'QualityJudge');
```

#### 返回值

相应的绝对路径

## 轻应用间跳转

### 打开

#### 方法说明

```javascript
u9.openWin(cfg);
```

打开轻应用。

#### 参数说明

`cfg`有以下配置项：

| 参数名      | 必填      | 类型      | 描述                         |
| ----------- | --------- | --------- | ---------------------------- |
| id          | 是        | string    | 跳转目标轻应用ID             |
| url         | 是        | string    | 跳转目标轻应用index.html路径，相对路径，相对于目标轻应用        |
| pageParam   | 否        | object    | 可选，仅配置额外数据，基础共享数据会统一加上   |
| animation   | 否        | object    | 可选                         |

#### 调用示例

```javascript
u9.openWin({
    id: 'DemoHD',
    url: 'www/index.html'
});
```

#### 返回值

无

---

### 打开

#### 方法说明

```javascript
u9.closeWin();
```

关闭当前轻应用。

#### 参数说明

无

#### 调用示例

```javascript
u9.closeWin();
```

#### 返回值

无
